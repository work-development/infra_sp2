# Проект docker-compose: в трёх docker-контейнерах развёрнут проект YaMDb 

## Краткое описание проекта "YaMDb"
Проект "**YaMDb**" — база отзывов пользователей о фильмах, книгах и музыке.  
Задача проекта - создание API для организации доступа к базе отзывов о фильмах, книгах и музыке.  

С помощью API, можно получить доступ к следующим ресурсам:
* TITLES: произведения, к которым пишут отзывы (просмотр, создание, редактирование, удаление)
* CATEGORIES: категории (типы) произведений (просмотр, создание, редактирование, удаление)
* GENRES: жанры произведений (просмотр, создание, редактирование, удаление)
* REVIEWS: отзывы на произведения (просмотр, создание, редактирование, удаление)
* COMMENTS: комментарии к отзывам (просмотр, создание, редактирование, удаление)
* AUTH: аутентификация (Получение JWT-токена в обмен на email и confirmation_code)
* USERS: пользователи (просмотр, создание, редактирование, удаление)

## Пользовательские роли  
* **Аноним** — может просматривать описания произведений, читать отзывы и комментарии.  
* **Аутентифицированный пользователь** — может, как и Аноним, читать всё, дополнительно он может публиковать отзывы и ставить рейтинг произведениям (фильмам/книгам/песням), может комментировать чужие отзывы и ставить им оценки; может редактировать и удалять свои отзывы и комментарии.  
* **Модератор** — те же права, что и у Аутентифицированного пользователя плюс право удалять любые отзывы и комментарии.  
* **Администратор** — полные права на управление проектом и всем его содержимым. Может создавать и удалять категории и произведения. Может назначать роли пользователям.  
* **Администратор Django** — те же права, что и у роли Администратор.  

## Алгоритм регистрации пользователей  
1. Пользователь отправляет запрос с параметром email на /auth/email/.  
2. YaMDB отправляет письмо с кодом подтверждения (confirmation_code) на адрес email.  
3. Пользователь отправляет запрос с параметрами email и confirmation_code на /auth/token/, в ответе на запрос ему приходит token (JWT-токен).  
4. При желании пользователь отправляет PATCH-запрос на /users/me/ и заполняет поля в своём профайле (описание полей — в документации).  

## Команды для установки и запуска приложения
Для установки на локальной машине потребуется:
* Скачать файлы docker-compose.yaml и Dockerfile из репозитория
* Запустите docker-compose командой  *docker-compose up* из корня проекта
* Зайти через браузер на страницу http://localhost:8000/api/v1/

## Команда для создания суперпользователя
Необходимо запустить контейнер 
```
docker-compose up
```
затем необходимо узнать ID запущенного контейнера с веб-приложением (api_yamdb_web_1) командой
```
docker container ls 
```
после этого в новом окне cmd нужно выполнить миграции
```
docker exec -ti ID python manage.py migrate
```
после чего суперпользователь может быть создан командой 
```
docker exec -ti ID python manage.py createsuperuser
```

## Команда для заполнения базы начальными данными
Данные из базы данных db.sqlite3 проекта "YaMDb" были укомплектованы в файл fixtures.json
```
(venv) директория>python manage.py dumpdata > fixtures.json
```
затем в cmd в директории проекта был запущен штабель из контейнеров 
```
директория>docker-compose up
```
после чего в другом окне cmd был скопирован полученный файл fixtures.json в контейнер
```
docker cp fixtures.json ID_контейнера_web:/fixtures.json
```
Затем было осуществлнно копирование данных в бд контейнера
```
(venv) директория проекта>docker exec -ti ID_контейнера python manage.py loaddata /fixtures.json
```
## API
Передача данных осуществляется по протоколу HTTP.  
Применяются принципы REST API.  
Сервер отвечает в формате JSON.  
Аутентификация осуществляется по JWT-токену.  
Адрес API: http://localhost:8000/api/v1/  
Документация с примерами команд: http://localhost:8000/redoc/  
## Несколько примеров использования API
**GET /titles/** - получить список всех произведений  
Ответ (200):  
Ключ|Значение|Описание
----|--------|--------
"id"|number|ID произведения
"name"|"string"|Название
"year"|number|Год выпуска
"rating"|number|Рейтинг на основе отзывов
"description"|"string"|Описание
"genre"|Array of objects|Жанр
||"name"|Название жанра
||"slug"|Поле "slug" 
"category"|objects|Категория
||"name"|Название категории объекта
||"slug"|Поле "slug" 
  
**POST /auth/email/** - передача confirmation_code на адрес эл.почты  
Запрос:  
Ключ|Значение|Описание
----|--------|--------
email|"string"|адрес эл.почты

В результате выполнения этого запроса, пользователь получает на указанный адрес эл.почты код подтверждения __confirmation_code__  

**POST /auth/token/** - получение JWT-токена в обмен на email и confirmation_code  
Запрос:  
Ключ|Значение|Описание
----|--------|--------
email|"string"|адрес эл.почты
confirmation_code|"string"|код подтверждения

**PATCH /users/me/** - изменить данные своей учетной записи  
Запрос:  
Ключ|Значение|Описание
----|--------|--------
"first_name"|"string"|Имя
"last_name"|"string"|Фамилия
"username"|"string"|Username
"bio"|"string"|О себе
"email"|"string"|Адрес электронной почты
"role"|"string"| Enum: "user" "moderator" "admin"  

Ответ (200):
Ключ|Значение|Описание
----|--------|--------
"first_name"|"string"|Имя
"last_name"|"string"|Фамилия
"username"|"string"|Username
"bio"|"string"|О себе
"email"|"string"|Адрес электронной почты
"role"|"string"| Enum: "user" "moderator" "admin"  


__**Более подробную информацию о методах данного API можно получить по адресу http://localhost:8000/redoc/**__

